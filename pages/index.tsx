import { useState, ChangeEvent } from 'react'
import Head from 'next/head'
import { useQuery } from "@apollo/client"

import { GET_ALL_CHARACTERS } from "../queries"

import Search from "../components/Search"
import Header from "../components/Header"
import Loader from "../components/Loader";
import Pagination from "../components/Pagination"
import Card from "../components/Card";

import { Main, Content, CardSection } from '../styles/styles'


const Home = () => {
    const [character, setCharacter] = useState<string>("");
    const [page, setPage] = useState<number>(1)

    const { loading, error, data } = useQuery(GET_ALL_CHARACTERS, {
      variables: {
          page: page,
          character: character,
      },
    })

    const handleOnChange = (e: ChangeEvent<HTMLTextAreaElement | HTMLInputElement>) => {
        setCharacter(e.target.value)
    }

    return (
        <Main>
          <Head>
            <title>Rick and Morty App</title>
            <meta name="description" content="Generated by create next app" />
            <link rel="icon" href="/favicon.ico" />
          </Head>
            <Header />
            <Search onChange={handleOnChange}/>
            <Content>
                {loading && <Loader />}
                <CardSection>
                    {data?.characters?.results.map((character:any) => (
                        <Card key={character.id} character={character} />
                    ))}
                </CardSection>
                <Pagination
                    pageCount={data?.characters?.info?.pages}
                    setPage={setPage}
                    currentPage={page}
                />
            </Content>
        </Main>
    )
}

export default Home
